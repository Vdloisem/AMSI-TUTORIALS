<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>6&nbsp; The Object Constraint Language (OCL): An Overview – AMSI-TUTORIALS</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./07-practical-exercises-ocl.html" rel="next">
<link href="./05-practical-exercises-object-diagrams.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-485d01fc63b59abcd3ee1bf1e8e2748d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./06-ocl.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">The Object Constraint Language (OCL): An Overview</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">AMSI-TUTORIALS</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-intro-modelling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to Modelling</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-intro-uml.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to UML</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-class-diagrams.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Class and Object Diagrams</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-practical-exercises-class-diagrams.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Practical Exercises: Class Diagrams</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-practical-exercises-object-diagrams.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Practical Exercises: Object Diagrams</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-ocl.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">The Object Constraint Language (OCL): An Overview</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-practical-exercises-ocl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Practical Exercises: OCL Constraints</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-state-machine-diagrams.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">State Machine Diagrams</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-practical-exercises-state-machine-diagrams.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Practical Exercises: State Machines</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#the-need-for-precision-what-uml-diagrams-dont-say" id="toc-the-need-for-precision-what-uml-diagrams-dont-say" class="nav-link active" data-scroll-target="#the-need-for-precision-what-uml-diagrams-dont-say"><span class="header-section-number">6.1</span> The Need for Precision: What UML Diagrams Don’t Say</a></li>
  <li><a href="#introduction-to-ocl" id="toc-introduction-to-ocl" class="nav-link" data-scroll-target="#introduction-to-ocl"><span class="header-section-number">6.2</span> Introduction to OCL</a>
  <ul class="collapse">
  <li><a href="#language-philosophy" id="toc-language-philosophy" class="nav-link" data-scroll-target="#language-philosophy"><span class="header-section-number">6.2.1</span> Language Philosophy</a></li>
  </ul></li>
  <li><a href="#main-applications-of-ocl" id="toc-main-applications-of-ocl" class="nav-link" data-scroll-target="#main-applications-of-ocl"><span class="header-section-number">6.3</span> Main Applications of OCL</a></li>
  <li><a href="#fundamental-ocl-concepts" id="toc-fundamental-ocl-concepts" class="nav-link" data-scroll-target="#fundamental-ocl-concepts"><span class="header-section-number">6.4</span> Fundamental OCL Concepts</a>
  <ul class="collapse">
  <li><a href="#ocl-is-a-typed-language" id="toc-ocl-is-a-typed-language" class="nav-link" data-scroll-target="#ocl-is-a-typed-language"><span class="header-section-number">6.4.1</span> OCL is a Typed Language</a></li>
  <li><a href="#special-ocl-types" id="toc-special-ocl-types" class="nav-link" data-scroll-target="#special-ocl-types"><span class="header-section-number">6.4.2</span> Special OCL Types</a></li>
  <li><a href="#type-conformance-and-subtyping" id="toc-type-conformance-and-subtyping" class="nav-link" data-scroll-target="#type-conformance-and-subtyping"><span class="header-section-number">6.4.3</span> Type Conformance and Subtyping</a></li>
  <li><a href="#standard-ocl-operators" id="toc-standard-ocl-operators" class="nav-link" data-scroll-target="#standard-ocl-operators"><span class="header-section-number">6.4.4</span> Standard OCL Operators</a></li>
  <li><a href="#the-context-and-self-keywords" id="toc-the-context-and-self-keywords" class="nav-link" data-scroll-target="#the-context-and-self-keywords"><span class="header-section-number">6.4.5</span> The <code>context</code> and <code>self</code> Keywords</a></li>
  <li><a href="#writing-constraints-invariants" id="toc-writing-constraints-invariants" class="nav-link" data-scroll-target="#writing-constraints-invariants"><span class="header-section-number">6.4.6</span> Writing Constraints: Invariants</a></li>
  <li><a href="#writing-contracts-preconditions-and-postconditions" id="toc-writing-contracts-preconditions-and-postconditions" class="nav-link" data-scroll-target="#writing-contracts-preconditions-and-postconditions"><span class="header-section-number">6.4.7</span> Writing Contracts: Preconditions and Postconditions</a></li>
  <li><a href="#initial-and-derived-values-query-and-body-definitions" id="toc-initial-and-derived-values-query-and-body-definitions" class="nav-link" data-scroll-target="#initial-and-derived-values-query-and-body-definitions"><span class="header-section-number">6.4.8</span> Initial and Derived Values, Query and Body Definitions</a></li>
  <li><a href="#navigating-the-model" id="toc-navigating-the-model" class="nav-link" data-scroll-target="#navigating-the-model"><span class="header-section-number">6.4.9</span> Navigating the Model</a></li>
  <li><a href="#working-with-collections" id="toc-working-with-collections" class="nav-link" data-scroll-target="#working-with-collections"><span class="header-section-number">6.4.10</span> Working with Collections</a></li>
  <li><a href="#operations-on-all-objects-oclany" id="toc-operations-on-all-objects-oclany" class="nav-link" data-scroll-target="#operations-on-all-objects-oclany"><span class="header-section-number">6.4.11</span> Operations on All Objects (<code>OclAny</code>)</a></li>
  <li><a href="#special-operations-allinstances-and-oclisnew" id="toc-special-operations-allinstances-and-oclisnew" class="nav-link" data-scroll-target="#special-operations-allinstances-and-oclisnew"><span class="header-section-number">6.4.12</span> Special Operations: <code>allInstances</code> and <code>oclIsNew</code></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">The Object Constraint Language (OCL): An Overview</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>This chapter introduces the <strong>Object Constraint Language (OCL)</strong>, a formal language used to add precise and unambiguous rules to UML models. We will explore why UML diagrams alone are often insufficient and how OCL helps to create more rigorous and verifiable software specifications.</p>
<section id="the-need-for-precision-what-uml-diagrams-dont-say" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="the-need-for-precision-what-uml-diagrams-dont-say"><span class="header-section-number">6.1</span> The Need for Precision: What UML Diagrams Don’t Say</h2>
<p>As we have seen, UML diagrams, especially Class Diagrams, are powerful tools for modelling the static structure of a system. However, they cannot capture all the business rules and constraints that govern a system’s behaviour. A diagram can be syntactically correct but still allow for situations that are logically incorrect or violate business rules.</p>
<p>Consider the following class diagram for a car rental system:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/car-rental-cd.png" class="img-fluid figure-img" style="width:100.0%" alt="Class diagram for a car rental system."></p>
<figcaption>A class diagram for a car rental system.</figcaption>
</figure>
</div>
<p>This diagram leaves many important questions unanswered:</p>
<ul>
<li>Can a customer who is on the blacklist rent a new car?</li>
<li>How is the price of a rental calculated?</li>
<li>Can the pickup and drop-off branches be different?</li>
<li>Should a driver’s license be valid for the entire rental period?</li>
</ul>
<p>While we could add this information in natural language, this approach is notoriously unreliable. Natural language specifications are prone to what are often called the <strong>“7 Deadly Sins”</strong>:</p>
<div class="callout callout-style-default callout-warning no-icon callout-titled" title="The 7 Deadly Sins of Natural Language Specification">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
The 7 Deadly Sins of Natural Language Specification
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>Ambiguity:</strong> A statement can be interpreted in multiple ways.</li>
<li><strong>Contradiction:</strong> Two or more rules in the specification conflict with each other.</li>
<li><strong>Silence (Incompleteness):</strong> A required rule or feature is not mentioned at all.</li>
<li><strong>Noise:</strong> The text contains irrelevant information that obscures the actual requirements.</li>
<li><strong>Over-specification:</strong> The text unnecessarily describes implementation details (“how”) instead of requirements (“what”).</li>
<li><strong>Vagueness:</strong> The requirements are not stated precisely enough to be verified.</li>
<li><strong>Wishful Thinking:</strong> A requirement is described that is impossible to implement.</li>
</ul>
</div>
</div>
<p>These issues make automated verification impossible and lead to costly errors in implementation. To solve this, we need a formal, unambiguous way to express these rules, which is precisely the role of OCL.</p>
</section>
<section id="introduction-to-ocl" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="introduction-to-ocl"><span class="header-section-number">6.2</span> Introduction to OCL</h2>
<p>To solve the problems of ambiguity and imprecision, the <strong>Object Constraint Language (OCL)</strong> was created. It is the official standard from the OMG (Object Management Group) for adding formal constraints to UML models.</p>
<p>OCL is a <strong>declarative, textual, and formal language</strong>. This means:</p>
<ul>
<li><strong>Declarative:</strong> You specify <em>what</em> should be true, not <em>how</em> to check it.</li>
<li><strong>Textual:</strong> It integrates seamlessly with the graphical nature of UML diagrams.</li>
<li><strong>Formal:</strong> It has a well-defined mathematical foundation, which removes ambiguity.</li>
</ul>
<p>It is designed to be a middle ground: more precise than natural language, but less complex and easier to learn than purely mathematical formalisms.</p>
<section id="language-philosophy" class="level3" data-number="6.2.1">
<h3 data-number="6.2.1" class="anchored" data-anchor-id="language-philosophy"><span class="header-section-number">6.2.1</span> Language Philosophy</h3>
<p>To use OCL correctly, it is crucial to understand its core philosophy: OCL is a <strong>pure specification language</strong>, not a programming language. This has two major consequences:</p>
<div class="callout callout-style-default callout-note callout-titled" title="No Side Effects">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
No Side Effects
</div>
</div>
<div class="callout-body-container callout-body">
<p>An OCL expression is a query that can only <strong>read</strong> the state of the model, it can <strong>never change it</strong>. You cannot use OCL to assign a value to an attribute, create an object, or call an operation that modifies the system’s state. This guarantees that checking a constraint will never alter the system you are verifying.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Instantaneous Evaluation">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Instantaneous Evaluation
</div>
</div>
<div class="callout-body-container callout-body">
<p>The evaluation of an OCL expression is considered to be <strong>instantaneous</strong>. This is a powerful abstraction that means the state of the system is “frozen” during the evaluation of a constraint. You don’t have to worry about other parts of the system changing while your expression is being checked, which greatly simplifies writing complex rules.</p>
</div>
</div>
</section>
</section>
<section id="main-applications-of-ocl" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="main-applications-of-ocl"><span class="header-section-number">6.3</span> Main Applications of OCL</h2>
<p>OCL is a versatile language used to add precision to a model in several key ways. Let’s explore its main applications with concrete examples based on our car rental system.</p>
<ol type="1">
<li><p><strong>Constraining Models (Invariants):</strong> The primary use of OCL is to write <strong>invariants</strong>. An invariant is a rule that must be true for all instances of a class at all times.</p>
<p><em>Example: A customer’s discount must always be a positive value.</em></p>
<pre class="ocl"><code>context Customer inv:
  self.discount &gt;= 0</code></pre>
<p><strong>Explanation:</strong> This simple invariant ensures that for any <code>Customer</code> object, the <code>discount</code> attribute (which is an <code>Integer</code> in the diagram) can never be negative.</p></li>
<li><p><strong>Specifying Contracts (Preconditions &amp; Postconditions):</strong> OCL is used to define formal contracts for operations. A <strong>precondition</strong> must be true <em>before</em> an operation is executed, and a <strong>postcondition</strong> must be true <em>after</em>.</p>
<p><em>Example: To extend a rental, its state must be ‘active’.</em></p>
<pre class="ocl"><code>context Rental::extendRental(newDate: Date)
  pre must_be_active:
    self.state = 'active'</code></pre>
<p><strong>Explanation:</strong> This precondition checks that the <code>state</code> attribute of the <code>Rental</code> instance is equal to the string <code>'active'</code>. The operation cannot be called otherwise.</p></li>
<li><p><strong>Specifying Derived Values:</strong> OCL can define how the value of an attribute should be calculated from other information. This is for values that are not stored directly.</p>
<p><em>Example: Let’s define a derived boolean attribute <code>isPrivileged</code> for a <code>Customer</code>.</em></p>
<pre class="ocl"><code>context Customer derive: isPrivileged: Boolean =
  self.premium = true and self.discount &gt; 10</code></pre>
<p><strong>Explanation:</strong> This rule states that a customer is considered “privileged” if and only if their <code>premium</code> status is true and their <code>discount</code> is greater than 10.</p></li>
<li><p><strong>Defining Queries:</strong> You can use OCL to navigate through the model to retrieve information, much like a query.</p>
<p><em>Example: A query to get the set of all active rentals for a specific customer.</em></p>
<pre class="ocl"><code>context Customer
  def: getActiveRentals(): Set(Rental) =
    self.rental-&gt;select(r | r.state = 'active')</code></pre>
<p><strong>Explanation:</strong> This defines a new operation <code>getActiveRentals</code> on the <code>Customer</code> class. It navigates to the customer’s collection of <code>rental</code> and uses the <code>select</code> iterator to return a new set containing only those rentals whose <code>state</code> is ‘active’.</p></li>
</ol>
</section>
<section id="fundamental-ocl-concepts" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="fundamental-ocl-concepts"><span class="header-section-number">6.4</span> Fundamental OCL Concepts</h2>
<p>To write meaningful constraints, we first need to understand the two pillars of the OCL language: its <strong>robust typing system</strong>, and its <strong>precise syntax and the formal semantics</strong> that underpin it.</p>
<section id="ocl-is-a-typed-language" class="level3" data-number="6.4.1">
<h3 data-number="6.4.1" class="anchored" data-anchor-id="ocl-is-a-typed-language"><span class="header-section-number">6.4.1</span> OCL is a Typed Language</h3>
<p>Every element in OCL, from an attribute to the result of a complex navigation, has a <strong>type</strong>. This strong typing system ensures that expressions are well-formed and prevents errors, much like in languages like Java. OCL’s type system is built from three sources:</p>
<section id="primitive-types" class="level4" data-number="6.4.1.1">
<h4 data-number="6.4.1.1" class="anchored" data-anchor-id="primitive-types"><span class="header-section-number">6.4.1.1</span> Primitive Types</h4>
<p>OCL includes four fundamental, built-in types that are the basis for most expressions:</p>
<ul>
<li><code>Integer</code> (e.g., <code>5</code>, <code>-10</code>)</li>
<li><code>Real</code> (e.g., <code>3.14</code>, <code>-0.5</code>)</li>
<li><code>String</code> (e.g., <code>'active'</code>, <code>'John Doe'</code>)</li>
<li><code>Boolean</code> (<code>true</code>, <code>false</code>)</li>
</ul>
</section>
<section id="uml-model-types" class="level4" data-number="6.4.1.2">
<h4 data-number="6.4.1.2" class="anchored" data-anchor-id="uml-model-types"><span class="header-section-number">6.4.1.2</span> UML Model Types</h4>
<p>This is a powerful feature: <strong>every classifier you define in your UML model automatically becomes a new type in OCL</strong>. If you have a class named <code>Customer</code> in your diagram, <code>Customer</code> becomes a valid type in your OCL expressions. This allows you to write constraints that are perfectly tailored to your specific domain.</p>
</section>
<section id="collection-types" class="level4" data-number="6.4.1.3">
<h4 data-number="6.4.1.3" class="anchored" data-anchor-id="collection-types"><span class="header-section-number">6.4.1.3</span> Collection Types</h4>
<p>Because navigating associations often results in multiple objects, OCL has a rich set of built-in collection types to handle them. The collection is an abstract type with four concrete subtypes:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Collection Type</th>
<th style="text-align: left;">Order Matters?</th>
<th style="text-align: left;">Duplicates Allowed?</th>
<th style="text-align: left;">Example Literal</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong><code>Set(T)</code></strong></td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;"><code>Set{1, 2, 3}</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong><code>OrderedSet(T)</code></strong></td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;"><code>OrderedSet{1, 2, 3}</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong><code>Bag(T)</code></strong></td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;"><code>Bag{1, 2, 2, 3}</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong><code>Sequence(T)</code></strong></td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;"><code>Sequence{1, 3, 2, 3}</code></td>
</tr>
</tbody>
</table>
<p>By default, navigating a <code>*</code> multiplicity association returns a <code>Set</code>. Understanding these collection types is essential, as most non-trivial OCL expressions involve manipulating collections.</p>
</section>
</section>
<section id="special-ocl-types" class="level3" data-number="6.4.2">
<h3 data-number="6.4.2" class="anchored" data-anchor-id="special-ocl-types"><span class="header-section-number">6.4.2</span> Special OCL Types</h3>
<p>Beyond the primitive and model-based types, OCL provides a set of special, built-in classifiers that are essential for writing advanced constraints. The hierarchy of these types is shown in the diagram below.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/ocl-type-hierarchy.png" class="img-fluid figure-img" style="width:100.0%" alt="The OCL Type Hierarchy"></p>
<figcaption>A class diagram showing the OCL Type Hierarchy, with Classifier at the top.</figcaption>
</figure>
</div>
<p>Let’s explore the most important ones:</p>
<ul>
<li><p><strong><code>OclAny</code></strong>: This is the supertype of all other types in OCL (except for collection and tuple types). Any operation defined on <code>OclAny</code> (like <code>oclIsTypeOf()</code>) is available on all objects in your model.</p></li>
<li><p><strong><code>OclVoid</code></strong>: This type has only one possible value: <code>null</code>. It is used to check if a property has been set or not. Any expression that results in a division by zero, for example, will evaluate to <code>null</code>. You can check for this value using the <code>oclIsUndefined()</code> operation.</p></li>
<li><p><strong><code>OclInvalid</code></strong>: This type has only one value: <code>invalid</code>. It is used to represent the result of an ill-formed expression, for instance, when trying to navigate from <code>null</code>. It is a subtype of all other types, meaning an <code>invalid</code> value can “poison” an entire expression. You can check for it with <code>oclIsInvalid()</code>.</p></li>
<li><p><strong><code>TupleType</code></strong>: A tuple is a structured type that groups together several named parts, each with its own type. It’s similar to a struct or a record and is very useful for returning multiple values from a query operation.</p>
<pre class="ocl"><code>Tuple{name: String = 'Mikel', id: Integer = 123}</code></pre></li>
<li><p><strong><code>OclState</code></strong>: This special type is used exclusively within state machine diagrams. The operation <code>oclIsInState(stateName: OclState)</code> allows you to write a constraint that checks if an object is currently in a specific state, which is very powerful for defining state-dependent invariants.</p></li>
<li><p><strong><code>OclMessage</code></strong>: Used in interaction diagrams (like sequence diagrams), this type allows you to write constraints on the messages exchanged between objects. For example, you can check if a specific message has been sent or received.</p></li>
</ul>
</section>
<section id="type-conformance-and-subtyping" class="level3" data-number="6.4.3">
<h3 data-number="6.4.3" class="anchored" data-anchor-id="type-conformance-and-subtyping"><span class="header-section-number">6.4.3</span> Type Conformance and Subtyping</h3>
<p>The OCL type system is not flat, it has a rich hierarchy that defines which types are considered subtypes of others. This is known as <strong>type conformance</strong>. Understanding these rules is crucial, as it determines when a value of one type can be used where a value of another type is expected.</p>
<p>The main rules of type conformance in OCL are as follows:</p>
<ol type="1">
<li>For primitive numbers, the hierarchy is logical: <code>UnlimitedNatural</code> is a subtype of <code>Integer</code>, which is a subtype of <code>Real</code>.</li>
<li><code>OclAny</code> is the ultimate supertype for all non-collection types. This means any object from your UML model is conformant to <code>OclAny</code>.</li>
<li>The hierarchy of your <strong>UML model types</strong> mirrors the generalization (inheritance) relationships in your class diagram. If you have a <code>Student</code> class that inherits from <code>Person</code>, then <code>Student</code> is a subtype of <code>Person</code> in OCL.</li>
<li>For collections, <code>Set(T)</code>, <code>Bag(T)</code>, <code>Sequence(T)</code>, and <code>OrderedSet(T)</code> are all subtypes of the general <code>Collection(T)</code> type.</li>
<li>The special types have their own rules:
<ul>
<li><code>OclVoid</code> (representing <code>null</code>) is a subtype of all other types (except <code>OclInvalid</code>).</li>
<li><code>OclInvalid</code> is the ultimate subtype, it is a subtype of <em>every other type</em>. This explains why an <code>invalid</code> value can propagate through and “poison” any expression.</li>
</ul></li>
</ol>
<p>This hierarchy is visualized in the diagram below.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/type-conformance-rules.png" class="img-fluid figure-img" style="width:30.0%" alt="The OCL Type Hierarchy and its conformance rules."></p>
<figcaption>A class diagram showing the OCL Type Hierarchy and a list of the 7 conformance rules.</figcaption>
</figure>
</div>
</section>
<section id="standard-ocl-operators" class="level3" data-number="6.4.4">
<h3 data-number="6.4.4" class="anchored" data-anchor-id="standard-ocl-operators"><span class="header-section-number">6.4.4</span> Standard OCL Operators</h3>
<p>Like any language, OCL comes with a standard set of operators to perform logical, relational, and arithmetic operations. These are the building blocks for creating complex boolean expressions within your constraints.</p>
<section id="logical-operators" class="level4" data-number="6.4.4.1">
<h4 data-number="6.4.4.1" class="anchored" data-anchor-id="logical-operators"><span class="header-section-number">6.4.4.1</span> Logical Operators</h4>
<p>OCL supports the standard boolean logic operators. Note that they are written in lowercase.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Operator</th>
<th style="text-align: left;">Syntax</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>and</strong></td>
<td style="text-align: left;"><code>a and b</code></td>
<td style="text-align: left;">True if both <code>a</code> and <code>b</code> are true.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>or</strong></td>
<td style="text-align: left;"><code>a or b</code></td>
<td style="text-align: left;">True if either <code>a</code> or <code>b</code> is true.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>xor</strong></td>
<td style="text-align: left;"><code>a xor b</code></td>
<td style="text-align: left;">True if exactly one of <code>a</code> or <code>b</code> is true.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>not</strong></td>
<td style="text-align: left;"><code>not a</code></td>
<td style="text-align: left;">True if <code>a</code> is false.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>implies</strong></td>
<td style="text-align: left;"><code>a implies b</code></td>
<td style="text-align: left;">False only if <code>a</code> is true and <code>b</code> is false.</td>
</tr>
</tbody>
</table>
<p><em>Example: A premium customer must have a discount.</em></p>
<pre class="ocl"><code>context Customer inv:
  self.premium implies (self.discount &gt; 0)</code></pre>
<section id="the-if-then-else-expression" class="level5" data-number="6.4.4.1.1">
<h5 data-number="6.4.4.1.1" class="anchored" data-anchor-id="the-if-then-else-expression"><span class="header-section-number">6.4.4.1.1</span> The <code>if-then-else</code> Expression</h5>
<p>Unlike in many programming languages, <code>if</code> in OCL is not a statement but an <strong>expression</strong> that always returns a value.</p>
<pre class="ocl"><code>context Customer
  def: customerCategory: String =
    if self.premium then
      'High Value'
    else
      'Standard'
    endif</code></pre>
<div class="callout callout-style-default callout-warning callout-titled" title="Important Rules for `if` expressions">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important Rules for <code>if</code> expressions
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>The <code>else</code> clause is mandatory.</strong> Since <code>if</code> is an expression, it must always result in a value, so the <code>else</code> part can never be omitted.</li>
<li><strong>Type Conformance.</strong> The type of the <code>if</code> expression is the most specific common supertype of the <code>then</code> expression and the <code>else</code> expression.</li>
</ul>
</div>
</div>
</section>
<section id="a-note-on-evaluation" class="level5" data-number="6.4.4.1.2">
<h5 data-number="6.4.4.1.2" class="anchored" data-anchor-id="a-note-on-evaluation"><span class="header-section-number">6.4.4.1.2</span> A Note on Evaluation</h5>
<p>OCL has a very specific rule for evaluating boolean expressions that differs from many common programming languages.</p>
<div class="callout callout-style-default callout-warning callout-titled" title="No Short-Circuit Evaluation">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
No Short-Circuit Evaluation
</div>
</div>
<div class="callout-body-container callout-body">
<p>The logical operators <code>and</code>, <code>or</code>, and <code>xor</code> in OCL are <strong>strict</strong>. This means that <strong>both operands are always evaluated</strong>, even if the result of the first operand is enough to determine the outcome. There is no “short-circuit” or “lazy” evaluation. This is a common source of errors, especially when dealing with potentially null values.</p>
</div>
</div>
</section>
</section>
<section id="relational-arithmetic-and-string-operators" class="level4" data-number="6.4.4.2">
<h4 data-number="6.4.4.2" class="anchored" data-anchor-id="relational-arithmetic-and-string-operators"><span class="header-section-number">6.4.4.2</span> Relational, Arithmetic, and String Operators</h4>
<p>OCL provides a rich set of standard operators for the primitive types, allowing for the construction of detailed and precise expressions.</p>
<section id="relational-operators" class="level5" data-number="6.4.4.2.1">
<h5 data-number="6.4.4.2.1" class="anchored" data-anchor-id="relational-operators"><span class="header-section-number">6.4.4.2.1</span> Relational Operators</h5>
<p>These operators are used for comparison and work across most primitive types to produce a <code>Boolean</code> result.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Operator</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong><code>=</code></strong></td>
<td style="text-align: left;">Equality</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong><code>&lt;&gt;</code></strong></td>
<td style="text-align: left;">Inequality (not equal)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong><code>&lt;</code></strong></td>
<td style="text-align: left;">Less than</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong><code>&gt;</code></strong></td>
<td style="text-align: left;">Greater than</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong><code>&lt;=</code></strong></td>
<td style="text-align: left;">Less than or equal to</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong><code>&gt;=</code></strong></td>
<td style="text-align: left;">Greater than or equal to</td>
</tr>
</tbody>
</table>
</section>
<section id="arithmetic-operators-for-integer-and-real" class="level5" data-number="6.4.4.2.2">
<h5 data-number="6.4.4.2.2" class="anchored" data-anchor-id="arithmetic-operators-for-integer-and-real"><span class="header-section-number">6.4.4.2.2</span> Arithmetic Operators for (<code>Integer</code> and <code>Real</code>)</h5>
<p>OCL provides a standard library of arithmetic functions for numerical types.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Operator</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong><code>+</code>, <code>-</code>, <code>*</code>, <code>/</code></strong></td>
<td style="text-align: left;">Addition, Subtraction, Multiplication, Division</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong><code>abs()</code></strong></td>
<td style="text-align: left;">Absolute value</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong><code>floor()</code></strong>, <strong><code>round()</code></strong></td>
<td style="text-align: left;">Floor and Rounding functions</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong><code>max(n)</code></strong>, <strong><code>min(n)</code></strong></td>
<td style="text-align: left;">The maximum or minimum of two numbers</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong><code>mod(n)</code></strong></td>
<td style="text-align: left;">Modulo operation</td>
</tr>
</tbody>
</table>
</section>
<section id="operators-for-strings-string" class="level5" data-number="6.4.4.2.3">
<h5 data-number="6.4.4.2.3" class="anchored" data-anchor-id="operators-for-strings-string"><span class="header-section-number">6.4.4.2.3</span> Operators for Strings (<code>String</code>)</h5>
<p>OCL includes a powerful set of operations for manipulating strings.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Operation</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong><code>size()</code></strong></td>
<td style="text-align: left;">Returns the number of characters in the string.</td>
<td style="text-align: left;"><code>'hello'.size() = 5</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong><code>concat(s2)</code></strong></td>
<td style="text-align: left;">Concatenates another string <code>s2</code>.</td>
<td style="text-align: left;"><code>'hello'.concat(' world')</code> results in <code>'hello world'</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong><code>toUpper()</code></strong></td>
<td style="text-align: left;">Converts the string to uppercase.</td>
<td style="text-align: left;"><code>'hello'.toUpper()</code> results in <code>'HELLO'</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong><code>toLower()</code></strong></td>
<td style="text-align: left;">Converts the string to lowercase.</td>
<td style="text-align: left;"><code>'HELLO'.toLower()</code> results in <code>'hello'</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong><code>substring(i1, i2)</code></strong></td>
<td style="text-align: left;">Returns the substring from index <code>i1</code> to <code>i2</code>.</td>
<td style="text-align: left;"><code>'hello'.substring(2, 4)</code> results in <code>'ell'</code></td>
</tr>
</tbody>
</table>
<p><em>Example: An invariant stating that a car group’s category must be a single uppercase letter.</em></p>
<pre class="ocl"><code>context CarGroup inv:
  self.category.size() = 1 and self.category = self.category.toUpper()</code></pre>
</section>
</section>
<section id="operator-precedence" class="level4" data-number="6.4.4.3">
<h4 data-number="6.4.4.3" class="anchored" data-anchor-id="operator-precedence"><span class="header-section-number">6.4.4.3</span> Operator Precedence</h4>
<p>OCL defines a strict order of precedence to determine how complex expressions are evaluated. The following table lists the operators in decreasing order of priority, from highest (evaluated first) to lowest (evaluated last).</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Operator(s)</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>1</strong> (Highest)</td>
<td style="text-align: left;"><code>@pre</code></td>
<td style="text-align: left;">Time marker (used in post-conditions)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>2</strong></td>
<td style="text-align: left;"><code>.</code> , <code>-&gt;</code></td>
<td style="text-align: left;">Navigation (dot and arrow)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>3</strong></td>
<td style="text-align: left;"><code>not</code> , <code>-</code></td>
<td style="text-align: left;">Unary operators (negation)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>4</strong></td>
<td style="text-align: left;"><code>*</code> , <code>/</code></td>
<td style="text-align: left;">Multiplication, Division</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>5</strong></td>
<td style="text-align: left;"><code>+</code> , <code>-</code></td>
<td style="text-align: left;">Addition, Subtraction (binary)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>6</strong></td>
<td style="text-align: left;"><code>if-then-else-endif</code></td>
<td style="text-align: left;">Conditional expression</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>7</strong></td>
<td style="text-align: left;"><code>=</code> , <code>&lt;&gt;</code> , <code>&gt;</code> , <code>&lt;</code> , <code>&gt;=</code> , <code>&lt;=</code></td>
<td style="text-align: left;">Relational operators</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>8</strong></td>
<td style="text-align: left;"><code>and</code> , <code>or</code> , <code>xor</code></td>
<td style="text-align: left;">Logical operators</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>9</strong></td>
<td style="text-align: left;"><code>implies</code></td>
<td style="text-align: left;">Logical implication</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>10</strong> (Lowest)</td>
<td style="text-align: left;"><code>in</code></td>
<td style="text-align: left;">(Not covered yet)</td>
</tr>
</tbody>
</table>
<div class="callout callout-style-default callout-tip callout-titled" title="Best Practice: Use Parentheses">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Best Practice: Use Parentheses
</div>
</div>
<div class="callout-body-container callout-body">
<p>Even if you know the precedence rules, it is always a good practice to use parentheses <code>()</code> to make your expressions explicit and easier to read. This avoids any ambiguity for you and for others who will read your model.</p>
</div>
</div>
</section>
</section>
<section id="the-context-and-self-keywords" class="level3" data-number="6.4.5">
<h3 data-number="6.4.5" class="anchored" data-anchor-id="the-context-and-self-keywords"><span class="header-section-number">6.4.5</span> The <code>context</code> and <code>self</code> Keywords</h3>
<p>Every OCL constraint is anchored to a specific element in the UML model. The <strong><code>context</code></strong> keyword declares this anchor, defining the perspective from which the OCL expression will be evaluated. Within this context, the keyword <strong><code>self</code></strong> always refers to the specific instance of the element being constrained.</p>
<p>OCL defines three primary types of context:</p>
<section id="classifier-context" class="level4" data-number="6.4.5.1">
<h4 data-number="6.4.5.1" class="anchored" data-anchor-id="classifier-context"><span class="header-section-number">6.4.5.1</span> Classifier Context</h4>
<p>This is the most common context, used for defining <strong>invariants</strong>. The context is a classifier, typically a class, and <code>self</code> refers to an instance of that class.</p>
<p><strong>Syntax:</strong> <code>context &lt;ClassName&gt;</code></p>
<pre class="ocl"><code>context Customer inv:
  self.discount &gt;= 0</code></pre>
</section>
<section id="operation-context" class="level4" data-number="6.4.5.2">
<h4 data-number="6.4.5.2" class="anchored" data-anchor-id="operation-context"><span class="header-section-number">6.4.5.2</span> Operation Context</h4>
<p>This context is used to define <strong>preconditions</strong> and <strong>postconditions</strong> for an operation. The context is a specific operation within a class, and <code>self</code> refers to the instance of the class on which the operation is being called.</p>
<p><strong>Syntax:</strong> <code>context &lt;ClassName&gt;::&lt;operationName&gt;(...)</code></p>
<pre class="ocl"><code>context Rental::extendRental(newDate: Date)
  pre: self.state = 'active'</code></pre>
</section>
<section id="attribute-context" class="level4" data-number="6.4.5.3">
<h4 data-number="6.4.5.3" class="anchored" data-anchor-id="attribute-context"><span class="header-section-number">6.4.5.3</span> 3. Attribute Context</h4>
<p>This context is used to define constraints on an attribute, typically for <strong>derived values</strong> or <strong>initial values</strong>. The context is a specific attribute within a class, and <code>self</code> refers to the instance of the class that owns the attribute.</p>
<p><strong>Syntax:</strong> <code>context &lt;ClassName&gt;::&lt;attributeName&gt;: &lt;Type&gt;</code></p>
<pre class="ocl"><code>context Customer::isPrivileged: Boolean
  derive: self.premium = true and self.discount &gt; 10</code></pre>
</section>
</section>
<section id="writing-constraints-invariants" class="level3" data-number="6.4.6">
<h3 data-number="6.4.6" class="anchored" data-anchor-id="writing-constraints-invariants"><span class="header-section-number">6.4.6</span> Writing Constraints: Invariants</h3>
<p>The most common type of constraint you will write in OCL is the <strong>invariant</strong>.</p>
<div class="callout callout-style-default callout-note callout-titled" title="What is an Invariant?">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
What is an Invariant?
</div>
</div>
<div class="callout-body-container callout-body">
<p>An invariant is a constraint that must be <strong>true</strong> for all instances of a class at <strong>all times</strong> during the system’s execution. It defines a condition of integrity that can never be violated. If an operation causes an invariant to become false, the system is considered to be in an invalid state.</p>
</div>
</div>
<section id="syntax" class="level4" data-number="6.4.6.1">
<h4 data-number="6.4.6.1" class="anchored" data-anchor-id="syntax"><span class="header-section-number">6.4.6.1</span> Syntax</h4>
<p>The general syntax for an invariant is straightforward:</p>
<p><strong><code>context</code></strong> <code>&lt;Classifier&gt;</code> <strong><code>inv</code></strong> <code>[</code><constraint_name><code>]:</code> &nbsp;&nbsp;<code>&lt;boolean_expression&gt;</code></constraint_name></p>
<ul>
<li><strong><code>context &lt;Classifier&gt;</code></strong>: Specifies the class to which the invariant applies.</li>
<li><strong><code>inv</code></strong>: The stereotype indicating this is an invariant.</li>
<li><strong><code>[&lt;constraint_name&gt;]</code></strong>: An optional but highly recommended name for the constraint.</li>
<li><strong><code>&lt;boolean_expression&gt;</code></strong>: The OCL expression that must always evaluate to <code>true</code>.</li>
</ul>
</section>
<section id="invariant-examples" class="level4" data-number="6.4.6.2">
<h4 data-number="6.4.6.2" class="anchored" data-anchor-id="invariant-examples"><span class="header-section-number">6.4.6.2</span> Invariant Examples</h4>
<p>Let’s illustrate with a few examples based on our car rental system.</p>
<section id="example-1-simple-attribute-constraint" class="level5" data-number="6.4.6.2.1">
<h5 data-number="6.4.6.2.1" class="anchored" data-anchor-id="example-1-simple-attribute-constraint"><span class="header-section-number">6.4.6.2.1</span> Example 1: Simple Attribute Constraint</h5>
<p>A very common use for invariants is to restrict the possible values of an attribute.</p>
<ul>
<li><strong>Rule:</strong> A customer’s discount must be a positive value.</li>
</ul>
<pre class="ocl"><code>context Customer inv:
  self.discount &gt;= 0</code></pre>
</section>
<section id="example-2-constraint-across-an-association" class="level5" data-number="6.4.6.2.2">
<h5 data-number="6.4.6.2.2" class="anchored" data-anchor-id="example-2-constraint-across-an-association"><span class="header-section-number">6.4.6.2.2</span> Example 2: Constraint Across an Association</h5>
<p>Invariants are powerful for defining rules that involve multiple, associated classes.</p>
<ul>
<li><strong>Rule:</strong> A car that is currently assigned to an active rental cannot be part of a <code>CarGroup</code> marked as ‘in_maintenance’.</li>
</ul>
<pre class="ocl"><code>context Car inv:
  self.rental-&gt;exists(r | r.state = 'active') implies 
    self.carGroup.category &lt;&gt; 'in_maintenance'</code></pre>
</section>
<section id="example-3-constraint-with-inheritance" class="level5" data-number="6.4.6.2.3">
<h5 data-number="6.4.6.2.3" class="anchored" data-anchor-id="example-3-constraint-with-inheritance"><span class="header-section-number">6.4.6.2.3</span> Example 3: Constraint with Inheritance</h5>
<p>Invariants can also enforce rules related to a class hierarchy.</p>
<ul>
<li><strong>Rule:</strong> A customer who is on the blacklist (i.e., is of type <code>BlackListed</code>) cannot have any active rentals.</li>
</ul>
<pre class="ocl"><code>context Customer inv:
  self.oclIsTypeOf(BlackListed) implies
    self.rental-&gt;select(r | r.state = 'active')-&gt;isEmpty()</code></pre>
</section>
</section>
</section>
<section id="writing-contracts-preconditions-and-postconditions" class="level3" data-number="6.4.7">
<h3 data-number="6.4.7" class="anchored" data-anchor-id="writing-contracts-preconditions-and-postconditions"><span class="header-section-number">6.4.7</span> Writing Contracts: Preconditions and Postconditions</h3>
<p>While invariants define the rules for a class’s state, <strong>preconditions</strong> and <strong>postconditions</strong> define a <strong>contract</strong> for its operations. They specify what an operation requires to run and what it guarantees to accomplish.</p>
<div class="callout callout-style-default callout-note callout-titled" title="What are Preconditions and Postconditions?">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
What are Preconditions and Postconditions?
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>A <strong>precondition</strong> is a constraint that must be <code>true</code> <strong>before</strong> an operation is executed. It is the responsibility of the <em>caller</em> to satisfy the precondition. If it’s false, the operation should not be called.</li>
<li>A <strong>postcondition</strong> is a constraint that must be <code>true</code> <strong>after</strong> an operation has successfully completed. It is the responsibility of the <em>operation itself</em> to establish the postcondition.</li>
</ul>
</div>
</div>
<section id="syntax-1" class="level4" data-number="6.4.7.1">
<h4 data-number="6.4.7.1" class="anchored" data-anchor-id="syntax-1"><span class="header-section-number">6.4.7.1</span> Syntax</h4>
<p>The syntax is similar to invariants, but the context is an operation, and the stereotypes are <code>pre</code> and <code>post</code>.</p>
<p><strong><code>context</code></strong> <code>&lt;Classifier&gt;::&lt;operationName&gt;(...)</code> &nbsp;&nbsp;<strong><code>pre</code></strong> <code>[</code><constraint_name><code>]:</code> <code>&lt;boolean_expression&gt;</code> &nbsp;&nbsp;<strong><code>post</code></strong> <code>[</code><constraint_name><code>]:</code> <code>&lt;boolean_expression&gt;</code></constraint_name></constraint_name></p>
<section id="precondition-example" class="level5" data-number="6.4.7.1.1">
<h5 data-number="6.4.7.1.1" class="anchored" data-anchor-id="precondition-example"><span class="header-section-number">6.4.7.1.1</span> Precondition Example</h5>
<p>A precondition specifies the conditions under which an operation can be legally called.</p>
<ul>
<li><strong>Rule:</strong> A customer can only be added to the blacklist if they are not already on it.</li>
</ul>
<pre class="ocl"><code>context Customer::addToBlackList(d: Date)
  pre is_not_already_blacklisted:
    self.oclIsTypeOf(BlackListed) = false</code></pre>
<p><strong>Explanation:</strong> This contract states that before calling <code>addToBlackList</code> on a <code>Customer</code> object, that object must not already be of the type <code>BlackListed</code>.</p>
</section>
<section id="postcondition-example-and-the-pre-keyword" class="level5" data-number="6.4.7.1.2">
<h5 data-number="6.4.7.1.2" class="anchored" data-anchor-id="postcondition-example-and-the-pre-keyword"><span class="header-section-number">6.4.7.1.2</span> Postcondition Example and the <code>@pre</code> Keyword</h5>
<p>A postcondition specifies the state of the system after the operation has finished. A crucial tool for this is the <code>@pre</code> keyword, which allows you to refer to a value as it was <em>before</em> the operation started.</p>
<ul>
<li><strong>Rule:</strong> After a customer is successfully added to the blacklist, they must be of the type <code>BlackListed</code>.</li>
</ul>
<pre class="ocl"><code>context Customer::addToBlackList(d: Date)
  post is_now_blacklisted:
    self.oclIsTypeOf(BlackListed) = true</code></pre>
<p>Here’s a more complex example using <code>@pre</code>:</p>
<ul>
<li><strong>Rule:</strong> After a rental is extended, the new end date must be the one provided, and the number of associated cars must not have changed.</li>
</ul>
<pre class="ocl"><code>context Rental::extendRental(newDate: Date)
  post end_date_is_updated:
    self.endingDate = newDate
  post number_of_cars_is_unchanged:
    self.assignedCar-&gt;size() = self.assignedCar@pre-&gt;size()</code></pre>
<p><strong>Explanation:</strong></p>
<ul>
<li>The first postcondition checks the new value of <code>endingDate</code>.</li>
<li>The second postcondition is critical: it uses <code>self.assignedCar@pre</code> to refer to the collection of cars <em>before</em> the operation ran and ensures its size has not changed. This prevents unintended side effects.</li>
</ul>
</section>
</section>
</section>
<section id="initial-and-derived-values-query-and-body-definitions" class="level3" data-number="6.4.8">
<h3 data-number="6.4.8" class="anchored" data-anchor-id="initial-and-derived-values-query-and-body-definitions"><span class="header-section-number">6.4.8</span> Initial and Derived Values, Query and Body Definitions</h3>
<p>Beyond invariants and contracts, OCL can be used to precisely define how attributes and operations get their values.</p>
<section id="init-specifying-initial-values" class="level4" data-number="6.4.8.1">
<h4 data-number="6.4.8.1" class="anchored" data-anchor-id="init-specifying-initial-values"><span class="header-section-number">6.4.8.1</span> <code>init</code>: Specifying Initial Values</h4>
<p>The <strong><code>init</code></strong> stereotype allows you to define a constraint for the initial value of an attribute when an object is created. This is more powerful than a simple default value because you can use a complex OCL expression.</p>
<p><strong>Syntax:</strong> <code>context &lt;ClassName&gt;::&lt;attributeName&gt;: &lt;Type&gt; init: &lt;expression&gt;</code></p>
<p><em>Example: When a <code>Rental</code> object is created, its <code>state</code> is initialized to ‘planned’.</em></p>
<pre class="ocl"><code>context Rental::state: String
  init: 'planned'</code></pre>
</section>
<section id="derive-specifying-derived-values" class="level4" data-number="6.4.8.2">
<h4 data-number="6.4.8.2" class="anchored" data-anchor-id="derive-specifying-derived-values"><span class="header-section-number">6.4.8.2</span> <code>derive</code>: Specifying Derived Values</h4>
<p>The <strong><code>derive</code></strong> stereotype is used for attributes whose value is not stored but is always calculated based on other properties of the model. This is used for derived attributes, which are often denoted with a <code>/</code> in front of their name in a class diagram.</p>
<p><strong>Syntax:</strong> <code>context &lt;ClassName&gt;::&lt;attributeName&gt;: &lt;Type&gt; derive: &lt;expression&gt;</code></p>
<p><em>Example: A customer is considered “privileged” if they are premium and have a discount greater than 10.</em></p>
<pre class="ocl"><code>context Customer::isPrivileged: Boolean
  derive: self.premium = true and self.discount &gt; 10</code></pre>
</section>
<section id="def-defining-query-operations" class="level4" data-number="6.4.8.3">
<h4 data-number="6.4.8.3" class="anchored" data-anchor-id="def-defining-query-operations"><span class="header-section-number">6.4.8.3</span> <code>def</code>: Defining Query Operations</h4>
<p>The <strong><code>def</code></strong> stereotype allows you to define the body of a query operation directly in OCL. This is useful for specifying operations that retrieve information without changing the system’s state.</p>
<p><strong>Syntax:</strong> <code>context &lt;ClassName&gt; def: &lt;operationName&gt;(): &lt;ReturnType&gt; = &lt;expression&gt;</code></p>
<p><em>Example: Defining an operation that returns the set of all active rentals for a customer.</em></p>
<pre class="ocl"><code>context Customer
  def: getActiveRentals(): Set(Rental) =
    self.rental-&gt;select(r | r.state = 'active')</code></pre>
</section>
<section id="body-defining-operation-bodies" class="level4" data-number="6.4.8.4">
<h4 data-number="6.4.8.4" class="anchored" data-anchor-id="body-defining-operation-bodies"><span class="header-section-number">6.4.8.4</span> <code>body</code>: Defining Operation Bodies</h4>
<p>While <code>def</code> is used to define a new query operation not present in the UML model, the <strong><code>body</code></strong> stereotype is used to provide a <strong>concrete implementation</strong> for an operation that is already <strong>declared</strong> in a class diagram.</p>
<p>This is particularly useful when you want to formally specify the result of a query operation without leaving its logic ambiguous.</p>
<p><strong>Syntax:</strong> <code>context &lt;ClassName&gt;::&lt;operationName&gt;(): &lt;ReturnType&gt; body: &lt;expression&gt;</code></p>
<p><em>Example: Defining the body for a <code>getDiscountedPrice()</code> operation on the <code>Rental</code> class.</em></p>
<pre class="ocl"><code>context Rental::getDiscountedPrice(): Real
  body: self.price * (1 - self.customer.discount/100.0)</code></pre>
<p><strong>Explanation:</strong> This OCL constraint provides the implementation for the <code>getDiscountedPrice()</code> operation. It specifies that the returned <code>Real</code> value is calculated by taking the rental’s base <code>price</code> and applying the <code>discount</code> associated with the <code>customer</code>. Any programming language implementation of this class would now have a formal specification to follow for this method.</p>
</section>
</section>
<section id="navigating-the-model" class="level3" data-number="6.4.9">
<h3 data-number="6.4.9" class="anchored" data-anchor-id="navigating-the-model"><span class="header-section-number">6.4.9</span> Navigating the Model</h3>
<p>The primary power of OCL comes from its ability to navigate through a class diagram, starting from a context instance (<code>self</code>) to access its attributes, call its operations, and traverse its associations to reach other objects.</p>
<section id="accessing-properties-and-traversing-associations" class="level4" data-number="6.4.9.1">
<h4 data-number="6.4.9.1" class="anchored" data-anchor-id="accessing-properties-and-traversing-associations"><span class="header-section-number">6.4.9.1</span> Accessing Properties and Traversing Associations</h4>
<p>Navigation is performed using the dot (<code>.</code>) notation.</p>
<ul>
<li><strong>Accessing Attributes:</strong> <code>self.age</code></li>
<li><strong>Calling Operations:</strong> <code>self.getAge()</code> (Note: operations must be query-only and have no side effects).</li>
<li><strong>Traversing an Association:</strong> To navigate, you use the <strong>role name</strong> at the opposite end of the association. If the role is unnamed, you use the name of the class itself, starting with a lowercase letter.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/navigation-person-company.png" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption>A diagram showing a Person class associated with a Company class.</figcaption>
</figure>
</div>
<pre class="ocl"><code>context Person inv:
  -- Navigates from Person to Company via the 'employer' role.
  -- The result is a single object of type Company.
  self.employer</code></pre>
</section>
<section id="navigation-from-a-collection" class="level4" data-number="6.4.9.2">
<h4 data-number="6.4.9.2" class="anchored" data-anchor-id="navigation-from-a-collection"><span class="header-section-number">6.4.9.2</span> Navigation From a Collection</h4>
<p>This is a fundamental concept in OCL. When you start a navigation from an expression that results in a collection, the navigation is performed on <strong>each element</strong> of that collection. The final result is a new collection containing all the individual results.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/navigation-administration-person.png" class="img-fluid figure-img"></p>
<figcaption>A diagram showing navigation from an Administration object to a collection of Person objects.</figcaption>
</figure>
</div>
<pre class="ocl"><code>context Administration inv:
  -- 1. self.persons returns a Set of Person objects: Set{p1, p2}
  self.persons

  -- 2. Navigating to 'name' from this Set returns a Bag of all names.
  -- The result is Bag{'jack', 'lisa'}
  self.persons.name

  -- 3. Navigating to 'age' returns a Bag of all ages.
  -- The result is Bag{30, 22}
  self.persons.age</code></pre>
<p><strong>Note:</strong> When you navigate from a <code>Set</code> to an attribute, the result is a <code>Bag</code>, not a <code>Set</code>, because different objects in the original set could have the same value for that attribute.</p>
</section>
<section id="chained-navigation" class="level4" data-number="6.4.9.3">
<h4 data-number="6.4.9.3" class="anchored" data-anchor-id="chained-navigation"><span class="header-section-number">6.4.9.3</span> Chained Navigation</h4>
<p>You can chain navigations together to traverse complex paths in your model. The rules of collection navigation apply at each step.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/navigation-chained-example.png" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption>A diagram showing chained navigation from Rental to AssignedCar, then CarGroup, then category.</figcaption>
</figure>
</div>
<pre class="ocl"><code>context Administration inv:
  -- self.persons -&gt; Set{p1, p2}
  -- self.persons.children returns a Bag containing all children of p1 and p2.
  self.persons.children

  -- This expression first gets all children (a Bag),
  -- then for each child, it navigates to their parents (a Set of 2 Persons).
  -- The final result is a Bag containing all the parents of all the children.
  self.persons.children.parent</code></pre>
<section id="a-note-on-flattening-collections" class="level5" data-number="6.4.9.3.1">
<h5 data-number="6.4.9.3.1" class="anchored" data-anchor-id="a-note-on-flattening-collections"><span class="header-section-number">6.4.9.3.1</span> A Note on Flattening Collections</h5>
<p>When a navigation path involves multiple “to-many” associations, OCL automatically simplifies the result.</p>
<p>Consider the expression from the slide:</p>
<pre class="ocl"><code>context Administration inv:
  self.persons.car</code></pre>
<p>Let’s break this down:</p>
<ol type="1">
<li><code>self.persons</code> returns a <code>Set</code> of <code>Person</code> objects.</li>
<li>For each <code>Person</code> in that set, <code>.car</code> returns a <code>Set</code> of <code>Car</code> objects (because the multiplicity is <code>*</code>).</li>
<li>The result is therefore a collection of collections, for example: <code>Bag{ Set{car1}, Set{car2, car3} }</code>.</li>
</ol>
<p>Instead of forcing you to work with this complex nested structure, OCL <strong>automatically flattens</strong> it into a single <code>Bag</code> containing all the elements: <code>Bag{car1, car2, car3}</code>.</p>
<p>This is why you can continue the navigation chain directly. The expression <code>self.persons.car.type</code> works as follows:</p>
<ol type="1">
<li><code>self.persons.car</code> produces a flattened <code>Bag</code> of all cars owned by all persons.</li>
<li>The navigation <code>.type</code> is then applied to each <code>Car</code> in this flattened bag.</li>
<li>The final result is a <code>Bag</code> of all the <code>type</code> strings from all those cars.</li>
</ol>
</section>
</section>
</section>
<section id="working-with-collections" class="level3" data-number="6.4.10">
<h3 data-number="6.4.10" class="anchored" data-anchor-id="working-with-collections"><span class="header-section-number">6.4.10</span> Working with Collections</h3>
<p>Because navigation often results in collections, OCL provides a rich set of predefined operations to query and manipulate them. These operations are always invoked using the arrow (<code>-&gt;</code>) notation.</p>
<section id="basic-operations" class="level4" data-number="6.4.10.1">
<h4 data-number="6.4.10.1" class="anchored" data-anchor-id="basic-operations"><span class="header-section-number">6.4.10.1</span> Basic Operations</h4>
<p>These operations provide fundamental information about a collection or check for the presence of specific elements.</p>
<ul>
<li><strong><code>size()</code></strong>: Returns the number of elements.</li>
<li><strong><code>isEmpty()</code> / <code>notEmpty()</code></strong>: Checks if the collection is empty or not.</li>
<li><strong><code>includes(obj)</code> / <code>excludes(obj)</code></strong>: Checks if a specific object is in the collection.</li>
<li><strong><code>includesAll(coll2)</code> / <code>excludesAll(coll2)</code></strong>: Checks if all (or no) elements of another collection <code>coll2</code> are present.</li>
<li><strong><code>count(obj)</code></strong>: Counts the occurrences of an object in the collection (most useful for <code>Bag</code> and <code>Sequence</code>).</li>
</ul>
<p><em>Example: An invariant stating that a Person must have exactly two parents.</em></p>
<pre class="ocl"><code>context Person inv:
  self.parent-&gt;size() = 2</code></pre>
</section>
<section id="iterators-the-power-of-collections" class="level4" data-number="6.4.10.2">
<h4 data-number="6.4.10.2" class="anchored" data-anchor-id="iterators-the-power-of-collections"><span class="header-section-number">6.4.10.2</span> Iterators: The Power of Collections</h4>
<p>The most powerful feature of OCL collections is the ability to use <strong>iterators</strong>. An iterator is an operation that evaluates an expression for each element in a collection, allowing you to filter, transform, or verify its properties.</p>
<section id="select-and-reject-filtering" class="level5" data-number="6.4.10.2.1">
<h5 data-number="6.4.10.2.1" class="anchored" data-anchor-id="select-and-reject-filtering"><span class="header-section-number">6.4.10.2.1</span> <code>select</code> and <code>reject</code> (Filtering)</h5>
<p>These are the primary tools for filtering a collection. They return a new collection containing only the elements that satisfy (or don’t satisfy) a condition.</p>
<ul>
<li><strong><code>select(v | boolean_expression)</code></strong>: Returns a sub-collection with elements for which the expression is <code>true</code>.</li>
<li><strong><code>reject(v | boolean_expression)</code></strong>: Returns a sub-collection with elements for which the expression is <code>false</code>.</li>
</ul>
<p><em>Example: Select all rentals for a customer that are currently active.</em></p>
<pre class="ocl"><code>context Customer
  def: getActiveRentals(): Set(Rental) =
    self.rental-&gt;select(r | r.state = 'active')</code></pre>
</section>
<section id="forall-and-exists-quantifiers" class="level5" data-number="6.4.10.2.2">
<h5 data-number="6.4.10.2.2" class="anchored" data-anchor-id="forall-and-exists-quantifiers"><span class="header-section-number">6.4.10.2.2</span> <code>forAll</code> and <code>exists</code> (Quantifiers)</h5>
<p>These iterators evaluate a condition over a collection and return a single <code>Boolean</code> value. They are essential for writing precise invariants.</p>
<ul>
<li><strong><code>forAll(v | boolean_expression)</code></strong>: Returns <code>true</code> if the expression is true for <strong>all</strong> elements.</li>
<li><strong><code>exists(v | boolean_expression)</code></strong>: Returns <code>true</code> if the expression is true for <strong>at least one</strong> element.</li>
</ul>
<p><em>Example: An invariant stating that all cars in a “Luxury” car group must be of the brand “Mercedes”.</em></p>
<pre class="ocl"><code>context CarGroup inv:
  self.category = 'Luxury' implies
    self.car-&gt;forAll(c | c.brand = 'Mercedes')</code></pre>
</section>
<section id="collect-transformation" class="level5" data-number="6.4.10.2.3">
<h5 data-number="6.4.10.2.3" class="anchored" data-anchor-id="collect-transformation"><span class="header-section-number">6.4.10.2.3</span> <code>collect</code> (Transformation)</h5>
<p>The <code>collect</code> iterator transforms a collection by applying an expression to each of its elements. It returns a new <code>Bag</code> containing the results (similar to a <code>map</code> function).</p>
<p><em>Example: Get a collection of all the registration numbers of the cars rented by a customer.</em></p>
<pre class="ocl"><code>context Customer
  def: allRentedCarRegNums(): Bag(String) =
    self.rental.assignedCar.car-&gt;collect(c | c.regNum)</code></pre>
</section>
</section>
<section id="closure-transitive-closure" class="level4" data-number="6.4.10.3">
<h4 data-number="6.4.10.3" class="anchored" data-anchor-id="closure-transitive-closure"><span class="header-section-number">6.4.10.3</span> <code>closure</code> (Transitive Closure)</h4>
<p>The <code>closure</code> iterator is an advanced and extremely powerful operation that calculates the <strong>transitive closure</strong> of a relationship over a collection. In simpler terms, it allows you to repeatedly navigate through an association until no more new elements can be discovered.</p>
<p>This is the perfect tool for working with hierarchical or graph-like structures, such as finding all descendants of a person in a family tree or all sub-parts in an assembly.</p>
<p><strong>Syntax:</strong> <code>collection-&gt;closure( v | navigation_expression )</code></p>
<p><em>Example: Find all descendants of a person (their children, their children’s children, and so on).</em></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/person-children-example.png" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption>A class diagram showing a reflexive ‘children’ association on the Person class.</figcaption>
</figure>
</div>
<pre class="ocl"><code>context Person
  def: getAllDescendants(): Set(Person) =
    self.children-&gt;closure(p | p.children)</code></pre>
<p><strong>Explanation:</strong></p>
<ol type="1">
<li><code>self.children</code>: The expression starts with the set of the person’s direct children.</li>
<li><code>-&gt;closure(p | p.children)</code>: The <code>closure</code> iterator then takes each person <code>p</code> from that set, finds their own <code>children</code>, adds them to the result, and repeats this process until no new descendants can be found. The final result is a flattened <code>Set</code> containing all descendants at every level.</li>
</ol>
</section>
</section>
<section id="operations-on-all-objects-oclany" class="level3" data-number="6.4.11">
<h3 data-number="6.4.11" class="anchored" data-anchor-id="operations-on-all-objects-oclany"><span class="header-section-number">6.4.11</span> Operations on All Objects (<code>OclAny</code>)</h3>
<p>Because <code>OclAny</code> is the supertype of all types in your model, the operations it defines are available on <strong>every object</strong>. These are fundamental tools for checking equality, types, and for casting.</p>
<section id="equality-and" class="level4" data-number="6.4.11.1">
<h4 data-number="6.4.11.1" class="anchored" data-anchor-id="equality-and"><span class="header-section-number">6.4.11.1</span> Equality (<code>=</code> and <code>&lt;&gt;</code>)</h4>
<p>These operators check if two expressions refer to the exact same object instance.</p>
<ul>
<li><code>a = b</code>: Returns <code>true</code> if <code>a</code> and <code>b</code> are the same object.</li>
<li><code>a &lt;&gt; b</code>: Returns <code>true</code> if <code>a</code> and <code>b</code> are different objects.</li>
</ul>
</section>
<section id="type-checking-oclistypeof-vs.-ocliskindof" class="level4" data-number="6.4.11.2">
<h4 data-number="6.4.11.2" class="anchored" data-anchor-id="type-checking-oclistypeof-vs.-ocliskindof"><span class="header-section-number">6.4.11.2</span> Type Checking: <code>oclIsTypeOf</code> vs.&nbsp;<code>oclIsKindOf</code></h4>
<p>These two operations are crucial for writing constraints in a generalization hierarchy, but they have a very important semantic difference.</p>
<ul>
<li><strong><code>oclIsTypeOf(Type)</code></strong>: Returns <code>true</code> only if the object is an instance of that <strong>exact</strong> type, and not a subtype.</li>
<li><strong><code>oclIsKindOf(Type)</code></strong>: Returns <code>true</code> if the object is an instance of that type <strong>or any of its subtypes</strong>.</li>
</ul>
<p>Let’s consider the following hierarchy:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/generalization.png" class="img-fluid figure-img" style="width:70.0%" alt="A generalization hierarchy showing Student and Professor inheriting from Person."></p>
<figcaption>A generalization hierarchy showing Student and Professor inheriting from Person.</figcaption>
</figure>
</div>
<p>The following examples illustrate the difference:</p>
<pre class="ocl"><code>context Person inv:
  self.oclIsKindOf(Person)   -- returns true
  self.oclIsTypeOf(Person)   -- returns true
  self.oclIsKindOf(Student)  -- returns false
  self.oclIsTypeOf(Student)  -- returns true</code></pre>
<pre class="ocl"><code>context Student inv:
  self.oclIsKindOf(Person)   -- returns true
  self.oclIsTypeOf(Person)   -- returns false
  self.oclIsKindOf(Student)  -- returns true
  self.oclIsTypeOf(Student)  -- returns true
  self.oclIsKindOf(Professor)-- returns false
  self.oclIsTypeOf(Professor)-- returns false</code></pre>
</section>
<section id="type-casting-oclastype" class="level4" data-number="6.4.11.3">
<h4 data-number="6.4.11.3" class="anchored" data-anchor-id="type-casting-oclastype"><span class="header-section-number">6.4.11.3</span> Type Casting: <code>oclAsType</code></h4>
<p>This operation allows you to cast an object to a more specific subtype. This is necessary when you need to access attributes or operations that are only defined on that subtype.</p>
<ul>
<li><strong><code>oclAsType(Type)</code></strong>: Casts the object to the specified <code>Type</code>. If the object is not actually of that type or one of its subtypes, the expression result is <code>invalid</code>.</li>
</ul>
<p><em>Example: An invariant on a Person object, stating that if that person is a Student, their student ID must not be empty.</em></p>
<pre class="ocl"><code>context Person inv:
  self.oclIsKindOf(Student) implies
    self.oclAsType(Student).studentId-&gt;notEmpty()</code></pre>
<p><strong>Explanation:</strong> We first check if the <code>Person</code> is a <code>Student</code> (or a subtype). If so, we cast <code>self</code> to <code>Student</code> to be able to safely access the <code>studentId</code> attribute.</p>
</section>
<section id="handling-undefined-values-oclvoid" class="level4" data-number="6.4.11.4">
<h4 data-number="6.4.11.4" class="anchored" data-anchor-id="handling-undefined-values-oclvoid"><span class="header-section-number">6.4.11.4</span> Handling Undefined Values (<code>OclVoid</code>)</h4>
<p>In OCL, the value <code>null</code> has a specific type: <strong><code>OclVoid</code></strong>. It is used to represent an object that does not exist or an attribute that has not been set.</p>
<ul>
<li><strong><code>oclIsUndefined()</code></strong>: Returns <code>true</code> if the object is <code>null</code>.</li>
<li><strong><code>oclIsInvalid()</code></strong>: Returns <code>true</code> if an expression is ill-formed (e.g., navigating from <code>null</code>).</li>
</ul>
<p><em>Example: An invariant stating that every <code>Rental</code> must be associated with a <code>Customer</code> (i.e., the <code>driver</code> role cannot be empty).</em></p>
<pre class="ocl"><code>context Rental inv:
  self.driver.oclIsUndefined() = false</code></pre>
<p>This is a robust way to check that a mandatory association (1..*) is respected.</p>
<hr>
</section>
</section>
<section id="special-operations-allinstances-and-oclisnew" class="level3" data-number="6.4.12">
<h3 data-number="6.4.12" class="anchored" data-anchor-id="special-operations-allinstances-and-oclisnew"><span class="header-section-number">6.4.12</span> Special Operations: <code>allInstances</code> and <code>oclIsNew</code></h3>
<p>To conclude our overview of OCL, let’s look at two special operations that operate at a meta-level: one that queries all objects of a certain type, and another that checks for an object’s creation within a postcondition.</p>
<section id="allinstances-accessing-all-objects-of-a-type" class="level4" data-number="6.4.12.1">
<h4 data-number="6.4.12.1" class="anchored" data-anchor-id="allinstances-accessing-all-objects-of-a-type"><span class="header-section-number">6.4.12.1</span> <code>allInstances()</code>: Accessing All Objects of a Type</h4>
<p>The <code>allInstances()</code> operation is unique because it is called directly on a <strong>class</strong>, not on an instance (<code>self</code>). It returns a <code>Set</code> containing all instances of that specific class that currently exist in the system at the time of evaluation.</p>
<p><strong>Syntax:</strong> <code>&lt;ClassName&gt;.allInstances()</code></p>
<p>This operation is extremely powerful for writing global invariants that must hold true across the entire system.</p>
<p><em>Example: An invariant to enforce that every employee in the system has a unique employee ID.</em></p>
<pre class="ocl"><code>context Employee inv:
  Employee.allInstances()-&gt;forAll(e1, e2 | 
    e1 &lt;&gt; e2 implies e1.employeeId &lt;&gt; e2.employeeId
  )</code></pre>
<div class="callout callout-style-default callout-warning callout-titled" title="Use with Caution">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Use with Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>allInstances()</code> operation can be computationally expensive and conceptually dangerous. Using it on a type with a potentially huge or even infinite number of instances (like <code>Integer</code> or <code>String</code>) can lead to problems. It is best reserved for application-specific classes where the number of instances is manageable.</p>
</div>
</div>
</section>
<section id="oclisnew-checking-object-creation" class="level4" data-number="6.4.12.2">
<h4 data-number="6.4.12.2" class="anchored" data-anchor-id="oclisnew-checking-object-creation"><span class="header-section-number">6.4.12.2</span> <code>oclIsNew()</code>: Checking Object Creation</h4>
<p>The <code>oclIsNew()</code> operation is a special tool used <strong>only in postconditions</strong>. It returns <code>true</code> if the object on which it is called was created during the execution of the operation specified in the context.</p>
<p><em>Example: A postcondition for a <code>createRental(...)</code> operation on the <code>Customer</code> class, stating that a new <code>Rental</code> object has been created and is now linked to the customer.</em></p>
<pre class="ocl"><code>context Customer::createRental(...)
  post: let newRental : Rental = self.rental-&gt;select(r | r.oclIsNew())-&gt;asSequence()-&gt;first() in
    newRental.oclIsUndefined() = false and newRental.customer = self</code></pre>
<p><strong>Explanation:</strong> This advanced postcondition first finds the new <code>Rental</code> object created during the operation using <code>oclIsNew()</code> and then asserts that this new rental exists and is correctly associated with the current customer (<code>self</code>).</p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./05-practical-exercises-object-diagrams.html" class="pagination-link" aria-label="Practical Exercises: Object Diagrams">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Practical Exercises: Object Diagrams</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./07-practical-exercises-ocl.html" class="pagination-link" aria-label="Practical Exercises: OCL Constraints">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Practical Exercises: OCL Constraints</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>